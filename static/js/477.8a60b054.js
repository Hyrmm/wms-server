"use strict";(self["webpackChunkwms_client"]=self["webpackChunkwms_client"]||[]).push([[477],{5477:function(t,e,a){a.r(e),a.d(e,{default:function(){return k}});var o=function(){var t=this,e=t._self._c;return e("div",[e("Table",{attrs:{data:t.addData},on:{removeRow:t.removeRow}}),e("AddFormDailog",{attrs:{visible:t.addFormDailogVisible},on:{close:t.addFormDailogClose,addRow:t.addRow}}),e("div",{staticClass:"control-warpper"},[e("el-button",{attrs:{icon:"el-icon-plus",round:"",type:"primary"},on:{click:t.addFormDailogOpen}},[t._v("新增一条")]),e("el-button",{attrs:{type:"success",icon:"el-icon-check",round:""},on:{click:t.postRecording}},[t._v("提交选中")])],1)],1)},r=[],s=function(){var t=this,e=t._self._c;return e("div",[e("el-table",t._b({staticStyle:{width:"100%"},attrs:{stripe:!0}},"el-table",t.$attrs,!1),[e("el-table-column",{attrs:{prop:"id",label:"#",width:"40"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-checkbox",{attrs:{disabled:"success"==a.row.postStatus},model:{value:a.row.checked,callback:function(e){t.$set(a.row,"checked",e)},expression:"scope.row.checked"}})]}}])}),e("el-table-column",{attrs:{prop:"name",label:"名称"}}),e("el-table-column",{attrs:{prop:"type",label:"类型"}}),e("el-table-column",{attrs:{prop:"amount",label:"数量",width:"80"}}),e("el-table-column",{attrs:{prop:"price",label:"单价",width:"80"}}),e("el-table-column",{attrs:{prop:"totalCost",label:"成本",width:"80"}}),e("el-table-column",{attrs:{prop:"updata_date",label:"日期",width:"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("i",{staticClass:"el-icon-time"}),e("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(a.row.updata_date))])]}}])}),e("el-table-column",{attrs:{prop:"postStatus",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return["success"==a.row.postStatus?e("span",{staticStyle:{color:"#67c23a"}},[t._v("入库成功")]):"fail"==a.row.postStatus?e("span",{staticStyle:{color:"#f56c6c"}},[t._v("入库失败")]):e("span",{staticStyle:{color:"#e6a23c"}},[t._v("待提交")])]}}])}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{staticStyle:{color:"red"},attrs:{disabled:"success"==a.row.postStatus,type:"text"},on:{click:function(e){return t.removeRow(a.$index,a.row)}}},[t._v("删除 ")])]}}])})],1)],1)},l=[],d=function(){var t=this,e=t._self._c;return e("el-dialog",t._g(t._b({attrs:{title:"添加库存"},on:{closed:t.closed}},"el-dialog",t.$attrs,!1),t.$listeners),[e("el-form",{ref:"form",attrs:{model:t.addForm,"label-position":"left","label-width":"100px",rules:{name_type:[{type:"array",required:!0,message:"请输入要入库的名称及类型",trigger:"blur"}],amount:[{type:"number",min:1,required:!0,message:"请输要入库的数量(数字)",trigger:"blur"}],price:[{min:0,type:"number",required:!0,message:"请输入要入库的单价(数字)",trigger:"blur"}]}}},[e("el-form-item",{attrs:{label:"名称/类型",prop:"name_type"}},[e("el-cascader",{staticClass:"form-item",attrs:{options:t.storeOptions,props:{expandTrigger:"hover"},children:t.addForm.type},model:{value:t.addForm.name_type,callback:function(e){t.$set(t.addForm,"name_type",e)},expression:"addForm.name_type"}})],1),e("el-form-item",{attrs:{label:"数量",prop:"amount"}},[e("el-input",{staticClass:"form-item",attrs:{placeholder:"数量"},model:{value:t.addForm.amount,callback:function(e){t.$set(t.addForm,"amount",t._n(e))},expression:"addForm.amount"}})],1),e("el-form-item",{attrs:{label:"单价",prop:"price"}},[e("el-input",{staticClass:"el-input form-item",attrs:{placeholder:"单价"},model:{value:t.addForm.price,callback:function(e){t.$set(t.addForm,"price",t._n(e))},expression:"addForm.price"}})],1),e("el-form-item",{attrs:{label:"日期",prop:"date"}},[e("el-date-picker",{staticClass:"form-item",attrs:{type:"date",placeholder:"不填默认当前时间",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:t.addForm.updata_date,callback:function(e){t.$set(t.addForm,"updata_date",e)},expression:"addForm.updata_date"}})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.complete}},[t._v("立即添加")]),e("el-button",{on:{click:function(e){return t.$emit("close")}}},[t._v("取消")])],1)],1)},i=[],n=a(2932),c=a(2325),u={data:function(){return{}},mixins:[n.Y],methods:{complete(){this.$refs["form"].validate((t=>{t?(this.$message.success("添加成功"),this.$emit("addRow",{checked:!0,postStatus:"",stock_id:this.stockId,name:this.addForm.name_type[0],type:this.addForm.name_type[1],price:this.addForm.price,amount:this.addForm.amount,updata_date:this.addForm.updata_date?this.addForm.updata_date:(0,c.p6)(new Date),totalCost:this.addForm.amount*this.addForm.price}),this.$emit("close")):this.$message.error("添加失败,请检查格式!")}))}}},m=u,p=a(1001),f=(0,p.Z)(m,d,i,!1,null,"0143c182",null),h=f.exports,b={components:{AddFormDailog:h},data:function(){return{}},methods:{removeRow(t,e){this.$emit("removeRow",t,e)}}},_=b,y=(0,p.Z)(_,s,l,!1,null,"b7093e3a",null),F=y.exports,w={components:{Table:F,AddFormDailog:h},data:function(){return{}},computed:{},mixins:[n.K],methods:{postRecording(){this.post("inStore",["stock_id","price","amount","updata_date"])}}},g=w,v=(0,p.Z)(g,o,r,!1,null,"48397edd",null),k=v.exports},2932:function(t,e,a){a.d(e,{K:function(){return s},Y:function(){return l}});a(7658);var o=a(3822),r=a(5738);const s={data(){return{addData:[],addFormDailogVisible:!1}},methods:{addFormDailogClose(){this.addFormDailogVisible=!1},addFormDailogOpen(){this.addFormDailogVisible=!0},addRow(t){console.log(t),this.addData.push(t)},removeRow(t,e){this.$confirm("是否确认执行删除操作?","提示",{type:"warning",confirmButtonText:"确认",cancelButtonText:"取消"}).then((()=>{this.addData.splice(t,1),this.$message.success("删除成功")}))},async post(t,e){let a=r.el;"outStore"==t&&(a=r.Sb);for(let o of this.filterAddData){let t={};e.forEach((e=>{t[e]=o[e]}));let r=await a(t).catch((t=>{o.postStatus="fail"}));200==r.data.status?o.postStatus="success":o.postStatus="fail"}}},computed:{filterAddData(){return this.addData.filter((t=>t.checked&&"success"!=t.postStatus))}}},l={data:function(){return{addForm:{}}},computed:{...(0,o.rn)("store",["storeOptions","transportStatusOptions"]),stockId:function(){for(let t of this.storeOptions)if(t.label==this.addForm.name_type[0])for(let e of t.children)if(e.label==this.addForm.name_type[1])return e.stock_id;return""}},methods:{closed(){this.addForm={},this.$refs["form"].resetFields()}}}}}]);
//# sourceMappingURL=477.8a60b054.js.map